<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Stock Price Scraper - Signs of Improvement </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="" />
    <meta property="og:site_name" content="Signs of Improvement" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://jaredtconnor.com/blog/stock-price-scaper/" />
    <meta property="og:title" content="Stock Price Scraper" />
    <meta property="og:image" content="https://jaredtconnor.com" />
    <meta property="og:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="Stock Price Scraper" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="https://jaredtconnor.com" />

    <link rel="canonical" href="https://jaredtconnor.com/blog/stock-price-scaper/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://jaredtconnor.comcss/custom.css" />

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css" integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin="anonymous" />
    

    

    <link rel="shortcut icon"
        href="https://jaredtconnor.com/images/favicon.png">

    
    <link href="https://jaredtconnor.com/index.xml" rel="alternate" type="application/rss+xml" title="Signs of Improvement" />
    
</head>

<body>
    
<div class="mt-xl header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-auto">
                <a href="https://jaredtconnor.com">
                    <h1 class="name">Signs of Improvement</h1>
                </a>
            </div>
        </div>

        <div class="row justify-content-center">
            <ul class="nav nav-primary">
                
                <li class="nav-item">
                    <a class="nav-link" href="https://jaredtconnor.com/">
                        
                        Home
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://jaredtconnor.com/about/">
                        
                        About
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/jaredtconnor">
                        
                        GitHub
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://twitter.com/home">
                        
                        Twitter
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

<div class="content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-8">
                <h1 class="mx-0 mx-md-4 blog-post-title">Stock Price Scraper</h1>

                <div class="mb-md-4 meta">
                    
                    
                    

                    <span class="date middot" title='Wed Aug 30 2017 00:00:00 UTC'>
                        2017-08-30
                    </span>

                    <span class="reading-time middot">
                        3 min read
                    </span>

                    <div class="d-none d-md-inline tags">
                        <ul class="list-unstyled d-inline">
                            
                            <li class="d-inline middot">
                                <a href="https://jaredtconnor.com/tags/python">python</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://jaredtconnor.com/tags/web_scraping">web_scraping</a>
                            </li>
                            
                            <li class="d-inline middot">
                                <a href="https://jaredtconnor.com/tags/data_analysis">data_analysis</a>
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="markdown blog-post-content">
                    
    <h1 id="understanding-pandas-in-python">Understanding Pandas in Python:</h1>
<p>This was one of my first projects in python to understand data frames. Anyone interested in
data analysis with Python needs to understand how to use, manipulate, and structure data in
ways that are useful and required for your analysis. Thankfully, there are some <em>incredibly</em>
smart developers in this world that understand the importance of this task, so they developed
the <a href="https://pandas.pydata.org"><strong>Pandas</strong></a> package. On top of that, we can use the ever useful <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/"><strong>BeautifulSoup</strong></a>
package, which allows us to make automated scripts to interact with HTML backed webpages.</p>
<p>The way Beautiful soup works is by making an HTML request to a specific web page, and
given the structure of the webpage, we can specify places where we want to <em>scrape</em> information.</p>
<p>First off, here are the dependencies:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> bs4 <span style="color:#00f">as</span> bs
<span style="color:#00f">import</span> datetime <span style="color:#00f">as</span> dt
<span style="color:#00f">import</span> os
<span style="color:#00f">import</span> pandas <span style="color:#00f">as</span> pd
<span style="color:#00f">import</span> pandas_datareader.data <span style="color:#00f">as</span> web
<span style="color:#00f">from</span> pandas_datareader._utils <span style="color:#00f">import</span> RemoteDataError
<span style="color:#00f">import</span> pickle
<span style="color:#00f">import</span> requests
</code></pre></div><p>This function below does just that: Obviously, we could write out a long list that contains all
of the ticker symbols for the S&amp;P 500. But, there is probably structured data on some website
(<em>cough</em> Wikipedia <em>cough</em>) that we can use for the heavy lifting.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#008000">#Scrapes wikipedia S&amp;P 500 ticker table to create object</span>
<span style="color:#00f">def</span> save_sp500_tickers():
    resp = requests.get(<span style="color:#a31515">&#34;https://en.wikipedia.org/wiki/List_of_S%26P_500_companies&#34;</span>)
    soup = bs.BeautifulSoup(resp.text, <span style="color:#a31515">&#34;html.parser&#34;</span>)
    table = soup.find(<span style="color:#a31515">&#39;table&#39;</span>, {<span style="color:#a31515">&#39;class&#39;</span>:<span style="color:#a31515">&#39;wikitable sortable&#39;</span>})
    tickers = []

    <span style="color:#00f">for</span> row <span style="color:#00f">in</span> table.find_all(<span style="color:#a31515">&#39;tr&#39;</span>)[1:]:
        ticker = row.find_all(<span style="color:#a31515">&#39;td&#39;</span>)[0].text
        tickers.append(ticker)

    <span style="color:#00f">with</span> open(<span style="color:#a31515">&#39;sp500_tickers.pickle&#39;</span>, <span style="color:#a31515">&#39;wb&#39;</span>) <span style="color:#00f">as</span> f:
        pickle.dump(tickers, f)

</code></pre></div><p>This gives us a great list for all 500 ticker symbols. If you aren&rsquo;t familiar with Pickles
in Python, they are essentially a write-able file that can store data in a more compressed
manner than, say, a csv file. More info on them can be found <a href="https://ianlondon.github.io/blog/pickling-basics/">here</a></p>
<p>Now for the fun stuff, we need to actually pull the pricing info for given period of time.
We will first pickle in our ticker list, then actually use the yahoo finance port via the
pandas data reader library to pull real time pricing information for us. This package was
maintained back when I began this project, but I believe it&rsquo;s been discontinued.
What can still be used is the <a href="https://pandas-datareader.readthedocs.io/en/latest/">data reader</a> package associated with pandas.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#008000">#Gathering all ADJ close data from Yahoo API for tickers created</span>
<span style="color:#008000">#and storing in stock_data directory</span>
<span style="color:#00f">def</span> get_data_from_yahoo(reload_sp500=<span style="color:#00f">False</span>):
    <span style="color:#00f">if</span> reload_sp500:
        tickers = save_sp500_tickers()
    <span style="color:#00f">else</span>:
        <span style="color:#00f">with</span> open(<span style="color:#a31515">&#34;sp500_tickers.pickle&#34;</span>, <span style="color:#a31515">&#34;rb&#34;</span>) <span style="color:#00f">as</span> f:
            tickers = pickle.load(f)

    <span style="color:#00f">if</span> <span style="color:#00f">not</span> os.path.exists(<span style="color:#a31515">&#34;stock_data&#34;</span>):
        os.makedirs(<span style="color:#a31515">&#34;stock_data&#34;</span>)


    start = dt.datetime(2000,1,1)
    end = dt.datetime(2016,12,31)

    <span style="color:#00f">for</span> ticker <span style="color:#00f">in</span> tickers:
        <span style="color:#00f">try</span>:
            <span style="color:#00f">if</span> <span style="color:#00f">not</span> os.path.exists(<span style="color:#a31515">&#34;stock_data/</span><span style="color:#a31515">{}</span><span style="color:#a31515">&#34;</span>.format(ticker)):
                df = web.DataReader(ticker, <span style="color:#a31515">&#39;yahoo&#39;</span>, start, end)
                df.to_csv(<span style="color:#a31515">&#34;stock_data/</span><span style="color:#a31515">{}</span><span style="color:#a31515">&#34;</span>.format(ticker))
                print(<span style="color:#a31515">&#34;Gathered data on </span><span style="color:#a31515">{}</span><span style="color:#a31515">&#34;</span>.format(ticker))
            <span style="color:#00f">else</span>:
                print(<span style="color:#a31515">&#34;Already have data for </span><span style="color:#a31515">{}</span><span style="color:#a31515">&#34;</span>.format(ticker))

        <span style="color:#00f">except</span> RemoteDataError:
            print(<span style="color:#a31515">&#34;Data Error&#34;</span>)
            <span style="color:#00f">continue</span>
            
get_data_from_yahoo()

</code></pre></div><p>The main for loop here is the money maker. We&rsquo;re going to iteratively step through each
ticker, and using the pandas data reader, specify to pull the high price, low price, and
volume for the specified date range on a daily basis. For each of these, we&rsquo;re going to pop
this data out into a simple CSV file according to the ticker&rsquo;s name. Throw in some
additional try/except catches and this process could easily work for pulling stock price information.</p>
<h3 id="what-did-we-learn">What did we learn:</h3>
<p>While this was one of my first projects, and hindsight is 20/20, this started a rather deep and
continued dive into thinking about problems from a data perspective. While I learned about data
abstraction in my later computer science courses and am still learning about how to properly store
this data, thinking this way provides a simple heuristic to solve problems:</p>
<blockquote>
<p>Any problem can typically be solved with information, and information exists as data somewhere.</p>
</blockquote>



                </div>

                
            </div>
        </div>
    </div>
</div>

<section id="comments">
    <div class="py-3 content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-8">
                    <div class="comments">
                        <script src="https://utteranc.es/client.js" repo=""
                            issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async>
                            </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/stan.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    

    
    
        

    
</body>

</html>
