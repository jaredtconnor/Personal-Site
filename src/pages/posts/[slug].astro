---
import Renderer from '../../components/Renderer.astro'
import BlogPostMeta from '../../components/BlogPostMeta.astro'
import ContentLayout from '../../layouts/ContentLayout.astro'

import directus from '../../utils/directus'
import { readItems } from '@directus/sdk'

export async function getStaticPaths() {
  const posts = await directus.request(
    readItems('posts', {
      fields: ['*', { relation: ['*'] }],
    }),
  )
  return posts.map(post => ({ params: { slug: post.slug }, props: post }))
  console.log(post.content)
}


const { post } = Astro.params
---

<ContentLayout title={post.title} date={post.date}>
  <BlogPostMeta
    title={post.title}
    description={post.external ? undefined : post.description}
    publishDate={post.date.toISOString()}
    pagePath={`/post/${post.slug}`}
    ogImageAbsoluteUrl={post.ogImageAbsoluteUrl ? undefined : post.ogImagePath}
    slot="meta"
  />
  <Renderer content={post} slot="content" />
</ContentLayout>
