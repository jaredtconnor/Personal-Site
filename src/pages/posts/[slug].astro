---
import Renderer from '../../components/Renderer.astro'
import BlogPostMeta from '../../components/BlogPostMeta.astro'
import ContentLayout from '../../layouts/ContentLayout.astro'

import directus from '../../utils/directus'
import { readItems } from '@directus/sdk'

export async function getStaticPaths() {
  const posts = await directus.request(
    readItems('posts', {
      fields: ['*', { relation: ['*'] }],
    }),
  )
  return posts.map(post => ({ params: { slug: post.slug }, props: post }))
}

const { slug } = Astro.params
---

<ContentLayout title={post.title} date={post.date}>
  <BlogPostMeta
    title={frontmatter.title}
    description={frontmatter.external ? undefined : frontmatter.description}
    publishDate={frontmatter.date.toISOString()}
    pagePath={`/blog/${slug}`}
    ogImageAbsoluteUrl={ogImageAbsoluteUrl}
    slot="meta"
  />
  <Renderer content={post} slot="content" />
</ContentLayout>
